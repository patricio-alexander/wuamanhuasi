const DOM=document,arbolesAsignadosPorEstudiante=async a=>{const e=await fetch(`http://localhost/Dev/HuamanHuasi/admin/api/arboles_estudiante.php?cedula=${a}`),t=DOM.querySelector("#lista_asignaciones"),s=await e.json();if(s.notFound)return void(t.innerText="No se encontro arboles asignados");const o=s.map(a=>`\n      <li class="list-group-item" data-arbol-estudiante="${a.id_registro}-${a.id_arbol}">\n        ${a.especie}-${a.nombre_ruta}\n        <button type="button" class="btn" @click="eliminarAsignacion"><span class="icon-trash-o fs-5 fw-semibold"></span></button>\n      </li>\n    `).join("");t.innerHTML=o},arbolesNoAsignados=async()=>{const a=DOM.querySelector("#lista_arboles"),e=await fetch("http://localhost/Dev/HuamanHuasi/admin/api/arboles.php");if(!e.ok)return void(a.innerHTML='<div  class="dropdown-item">Arboles no disponibles</div>');const t=await e.json();let s="";t.forEach((a,e)=>{s+=`\n        \n\n       \n   <label class="list-group-item" >\n    <input class="form-check-input me-1" type="checkbox" name="idArbol${e}" value="${a.id_arbol}">\n${a.especie} - ${a.nombre_ruta}\n  </label>\n    `}),a.innerHTML=s};document.addEventListener("alpine:init",()=>{Alpine.store("estudiantesStore",{estudiantes:[],async init(){const a=await fetch("http://localhost/Dev/HuamanHuasi/admin/api/estudiantes.php"),e=a.json();this.estudiantes=e},async buscarEstudiantes(a){const{target:e}=a,t=`http://localhost/Dev/HuamanHuasi/admin/api/estudiantes.php?estudianteDni=${e.value}`,s=await fetch(t),o=await s.json();this.estudiantes=o}}),Alpine.data("arboles",()=>({arboles:[],async init(){const a=await fetch("http://localhost/Dev/HuamanHuasi/admin/api/arboles.php"),e=await a.json();this.arboles=e}}))});const asignarArbol=async a=>{const{target:e}=a,t="http://localhost/Dev/HuamanHuasi/admin/api/asignar_arbol.php",s=JSON.stringify(Object.fromEntries(new FormData(e))),o=await fetch(t,{method:"POST",body:s,headers:{"Content-Type":"application/json"}}),i=await o.json();if(i.success){arbolesNoAsignados(),Swal.fire("Asignado","Se ha asignado correctamente el arbol","success");DOM.querySelector("#modal_asignar_arbol");const a=DOM.querySelector(".input_cedula");arbolesAsignadosPorEstudiante(a.value)}},filtrarArboles=a=>{const{target:e}=a,t=DOM.querySelector("#lista_arboles"),s=t.querySelectorAll(".list-group-item");s.forEach(a=>{a.innerText.includes(e.value)?a.classList.remove("visually-hidden"):a.classList.add("visually-hidden")})},eliminarArbolAsignado=async({idArbol:a})=>{const e=await fetch(`http://localhost/Dev/HuamanHuasi/admin/api/arboles_estudiante.php?idArbol=${a}`,{method:"DELETE"}),t=await e.json();t.success&&(Swal.fire("Desasignado","Se ha ha removido correctamente el arbol","success"),arbolesNoAsignados());const s=DOM.querySelector("#lista_asignaciones");s.innerText||(s.innerText="No se encontro arboles asignados")},mostrarDatosEnModal=a=>{const{target:e}=a,t=DOM.querySelector("#modal_asignar_arbol"),s=t.querySelector(".modal-title"),o=t.querySelector(".modal-body .input_cedula"),i=t.querySelector(".modal-body .id_registro"),n=e,r=n.getAttribute("data-bs-whatever"),l=n.getAttribute("data-bs-id-registro"),[c,d,u]=r.split("-");s.textContent=`Arboles de ${d} ${u}`,arbolesAsignadosPorEstudiante(c),i.value=l,o.value=c,arbolesNoAsignados()},eliminarAsignacion=a=>{const{target:e}=a,t=e.closest("li"),[s,o]=t.getAttribute("data-arbol-estudiante").split("-");t.remove(),eliminarArbolAsignado({idArbol:o})},mostrarDropdownMultiSelect=a=>{const e=document.querySelector("#dropdown_lista_arboles");e.classList.add("show","mt-1")},closeMultiSelect=()=>{const a=document.querySelector("#dropdown_lista_arboles");a.classList.remove("show")};